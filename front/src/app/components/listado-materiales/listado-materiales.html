<div class="container mt-4">
  <h2 class="mb-4">Listado de Materiales</h2>

  @if (cargando) {
  <div class="alert alert-info">Cargando...</div>
  }
  @if (error) {
  <div class="alert alert-danger">{{ error }}</div>
  }

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">Filtros</h5>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <!-- Filtro por Ciudad -->
        <div class="col-md-3">
          <label class="form-label">Ciudad</label>
          <select class="form-select" [(ngModel)]="filtroCiudad">
            <option value="">Todas las ciudades</option>
            @for (ciudad of ciudades; track ciudad) {
            <option [value]="ciudad">{{ ciudad }}</option>
            }
          </select>
        </div>

        <!-- Filtro por Tipo -->
        <div class="col-md-3">
          <label class="form-label">Tipo</label>
          <select class="form-select" [(ngModel)]="filtroTipo">
            <option value="">Todos los tipos</option>
            @for (tipo of tipos; track tipo) {
            <option [value]="tipo">{{ tipo }}</option>
            }
          </select>
        </div>

        <!-- Filtro por Fecha de Compra -->
        <div class="col-md-3">
          <label class="form-label">Fecha de Compra</label>
          <input type="date" class="form-control" [(ngModel)]="filtroFechaCompra">
        </div>

        <!-- Botones de acci√≥n -->
        <div class="col-md-3 d-flex align-items-end gap-2">
          <button class="btn btn-primary w-50" (click)="aplicarFiltros()">
            üîç Aplicar
          </button>
          <button class="btn btn-outline-secondary w-50" (click)="limpiarFiltros()">
            üîÑ Limpiar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-3 d-flex justify-content-between align-items-center">
    <a routerLink="/materiales/nuevo" class="btn btn-primary">‚ûï Nuevo Material</a>

    @if (materialesFiltrados.length !== materiales.length) {
    <span class="text-muted">
      Mostrando {{ materialesFiltrados.length }} de {{ materiales.length }} materiales
    </span>
    }
  </div>

  <table class="table table-bordered table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th class="text-center">Nombre</th>
        <th class="text-center">Tipo</th>
        <th class="text-center">Precio</th>
        <th class="text-center">Ciudad</th>
        <th class="text-center">Fecha Compra</th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      @for (m of materialesFiltrados; track m.id) {
      <tr>
        <td>{{ m.nombre }}</td>
        <td>{{ m.tipo }}</td>
        <td>{{ m.precio | currency:'COP':'$':'1.0-0'}}</td>
        <td>{{ m.ciudad.nombre }}</td>
        <td>{{ m.fechaCompra}}</td>
        <td colspan="6">
          <div class="row">
            <div class="col d-flex justify-content-center">
                <a [routerLink]="['/materiales/editar/', m.id]" class="btn btn-sm btn-warning me-2">‚úèÔ∏è Editar</a>
                <button  class="btn btn-sm btn-danger" (click)="eliminarMaterial(m.id)"> ‚ùå Eliminar</button>
            </div>
          </div>
        </td>
      </tr>
      }
    </tbody>
  </table>

  @if (!cargando && materialesFiltrados.length === 0) {
  <div class="alert alert-warning">
    @if (filtroCiudad || filtroTipo || filtroFechaCompra) {
    No hay materiales que coincidan con los filtros aplicados.
    } @else {
    No hay materiales registrados.
    }
  </div>
  }
</div>
